(()=>{"use strict";function t(t){localStorage.setItem("library",JSON.stringify(t))}function e(){if(localStorage.library){let t=localStorage.getItem("library");return t=JSON.parse(t),t}return[]}function n(t){return(t=t.toLowerCase()).replace(/(^|\s)\S/g,(function(t){return t.toUpperCase()}))}function i(t){return t.replace(/\D/g,"")}function r(t,e=!1){e?(t.innerHTML="check_circle_outline",t.setAttribute("title","Mark as Unread")):(t.innerHTML="visibility",t.setAttribute("title","Mark as Complete"))}class o{constructor(t,e,i,r=!1){this.title=n(t),this.author=n(e),this.pages_total=i,this.pages_read=0,this.rating=0,this.categories=[],this.complete=r}}function a(n){let r=i(this.id),o=e();o.splice(r,1),t(o),g()}function l(){const n=document.getElementById("newBookForm").querySelectorAll("input");for(let t=0;t<n.length-1;t++)if(""==n[t].value)return void alert("fill in all the details before submitting");const i=new o(n[0].value,n[1].value,n[2].value,n[3].checked);let r=e();r.push(i),t(r),g()}function c(t){const n=e();let r=i(t),o=n[r];const a=document.getElementById(`tag container ${r}`);a.querySelectorAll(".tag").forEach((t=>{t.parentElement.removeChild(t)})),o.categories.slice().reverse().forEach((t=>{a.prepend(function(t){const e=document.createElement("div");e.setAttribute("class","tag");const n=document.createElement("span");n.innerHTML=t;const i=document.createElement("i");return i.innerHTML="close",i.setAttribute("class","material-icons"),i.setAttribute("id",t),i.addEventListener("click",d),e.appendChild(n),e.appendChild(i),e}(t))}))}function d(n){const r=e(),o=i(n.target.parentNode.parentNode.id),a=r[o];let l=a.categories.indexOf(n.target.id);a.categories.splice(l,1),t(r),c(o)}function u(n){if(""!=n.target.value&&"Enter"===n.key){const r=e(),o=i(n.target.id);n.target.value.split(",").forEach((e=>{r[o].categories.push(e),t(r)})),c(n.target.id),n.target.value=""}}function s(t){let e=i(this.id);const n=document.getElementById(`card ${e}`);n.querySelector(".cardFace").style.display="none";const r=document.createElement("div");r.setAttribute("class","tag-edit-container"),r.setAttribute("id",`tag edit container ${e}`);const o=document.createElement("div");o.setAttribute("class","tag-container"),o.setAttribute("id",`tag container ${e}`);const a=document.createElement("input");a.setAttribute("id",`tag input ${e}`),o.appendChild(a),a.addEventListener("keyup",u);const l=document.createElement("i");l.setAttribute("type","button"),l.innerHTML="done",l.setAttribute("title","Done"),l.setAttribute("class","material-icons-round doneButton"),l.setAttribute("id",`finish tagging ${e}`),l.addEventListener("click",(()=>{n.querySelector(".cardFace").style.display="block";let t=i(this.id);document.getElementById(`tag edit container ${t}`).remove(),document.getElementById(`finish tagging ${t}`).remove()})),r.appendChild(o),n.append(r,l),c(e),a.focus()}function m(n){let o=i(this.id),a=e(),l=a[o];l.complete=!l.complete,t(a),r(document.getElementById(this.id),l.complete)}function p(n){let r=i(this.id),o=e(),a=o[r];const l=document.getElementById(`card ${r}`),c=l.querySelector(".content"),d=document.getElementById(`update-input-field${r}`).querySelectorAll("input");for(let t=0;t<d.length;t++)if(""==d[t].value)return void alert("input cannot be left empty!");a.title=d[0].value,c.querySelector(".bookTitle").innerHTML=`"${a.title}"`,c.querySelector(".bookTitle").title=`Title: "${a.title}"`,a.author=d[1].value,c.querySelector(".bookAuthor").innerHTML=a.author,c.querySelector(".bookAuthor").title=`Author: "${a.author}"`,a.pages_total=d[2].value,t(o),document.getElementById(`update-input-field${r}`).remove(),l.querySelector(".cardFace").style.display="block"}function b(e,n){const i=document.createElement("div");i.title=e.title,i.id=`card ${n}`,i.className="card";const o=document.createElement("container");o.className="cardFace";const l=document.createElement("div");l.className="content";const c=document.createElement("progress");c.setAttribute("max",e.pages_total),c.setAttribute("id",`progress ${n}`),c.setAttribute("value",e.pages_read),c.setAttribute("title",`You're on page ${e.pages_read} out of ${e.pages_total}.`),c.addEventListener("click",(()=>{let n=parseInt(prompt("What page are you on?"));n>=e.pages_total&&(n=e.pages_total),n<0|!n||(e.pages_read=n,t(library),updateDisplay())})),l.appendChild(c);const d=document.createElement("div");d.className="rating-box",d.title=e.rating/20*10/10+" stars";const u=document.createElement("div");u.className="rating",u.style.width=e.rating+"%",d.setAttribute("id",`rating ${n}`),d.addEventListener("click",(i=>{const r=document.getElementById(`rating ${n}`);r.querySelector(".rating").style.width=i.layerX+"%",e.rating=i.layerX,r.title=e.rating/20*10/10+" stars",t(library)})),d.appendChild(u),l.appendChild(d);const p=document.createElement("p");p.textContent=`"${e.title}"`,p.title=`Title: "${e.title}"`,p.setAttribute("class","bookTitle"),l.appendChild(p);const b=document.createElement("p");b.textContent=e.author,b.title=`Author: "${e.author}"`,b.setAttribute("class","bookAuthor"),l.appendChild(b),o.appendChild(l);const g=document.createElement("div");g.setAttribute("class","cardButtons");const h=document.createElement("i");h.innerHTML="delete_forever",h.setAttribute("title","Remove book from library"),h.setAttribute("class","material-icons-round deleteButton"),h.setAttribute("id",`remove ${n}`),h.addEventListener("click",a),g.appendChild(h),g.appendChild(function(t){const e=document.createElement("i");return e.innerHTML="label",e.setAttribute("title","Add tags"),e.setAttribute("class","material-icons-round tagButton"),e.setAttribute("id",`tag ${t}`),e.addEventListener("click",s),e}(n));const y=document.createElement("i");y.innerHTML="create",y.setAttribute("title","Edit book details"),y.setAttribute("class","material-icons-round editButton"),y.setAttribute("id",`edit ${n}`),y.addEventListener("click",A),g.appendChild(y);const E=function(t){const e=document.createElement("i");return e.setAttribute("class","material-icons-round completeButton"),e.setAttribute("id",`complete ${t}`),e.addEventListener("click",m),e}(n);return r(E,e.complete),g.appendChild(E),o.appendChild(g),i.appendChild(o),i}function A(t){let n=i(this.id),r=e()[n];const o=document.getElementById(`card ${n}`);o.querySelector(".cardFace").style.display="none";const a=document.createElement("form");a.id=`update-input-field${n}`;const l=document.createElement("div"),c=document.createElement("input");l.appendChild(c),c.setAttribute("value",r.title),c.setAttribute("type","text"),c.setAttribute("name","Edit Title"),c.minlength=1;const d=document.createElement("div"),u=document.createElement("input");d.appendChild(u),u.setAttribute("value",r.author),u.setAttribute("type","text"),u.setAttribute("name","Edit Author"),u.required=!0;const s=document.createElement("div"),m=document.createElement("input");s.appendChild(m),m.setAttribute("value",r.pages_total),m.setAttribute("type","number"),m.setAttribute("name","Edit Total Pages"),m.setAttribute("min","0"),m.setAttribute("oninput","validity.valid||(value='');"),m.required=!0;const b=document.createElement("i");b.setAttribute("type","button"),b.setAttribute("class","material-icons-round"),b.setAttribute("id",`update ${n}`),b.innerHTML="done",b.addEventListener("click",p);const A=document.createElement("i");A.setAttribute("type","button"),A.setAttribute("class","material-icons-round"),A.innerHTML="close",A.formNoValidate=!0,A.addEventListener("click",(()=>{o.querySelector(".cardFace").style.display="initial";let t=i(this.id);document.querySelector(`#update-input-field${t}`).remove()})),a.append(l,d,s,b,A),o.appendChild(a),c.focus()}function g(){let t=e();document.querySelector("main").innerHTML="",h(t)}function h(t){const e=document.querySelector("main");e.appendChild(function(){const t=document.createElement("div");t.className="card",t.id="newBookForm";const e=document.createElement("button");e.id="addNewButton",e.title="Add new book to Library",e.textContent="+",e.addEventListener("click",(()=>{document.querySelector("#input-field").style.display="initial",e.style.display="none"})),t.appendChild(e);const n=document.createElement("form");n.id="input-field";const i=document.createElement("div"),r=document.createElement("input");i.appendChild(r),r.setAttribute("placeholder","Book Title"),r.setAttribute("id","title"),r.setAttribute("type","text"),r.setAttribute("name","title");const o=document.createElement("div"),a=document.createElement("input");o.appendChild(a),a.setAttribute("placeholder","Author"),a.setAttribute("id","author"),a.setAttribute("type","text"),a.setAttribute("name","author");const c=document.createElement("div"),d=document.createElement("input");c.appendChild(d),d.setAttribute("placeholder","Page count"),d.setAttribute("id","bookLength"),d.setAttribute("type","number"),d.setAttribute("name","bookLength"),d.setAttribute("min","0"),d.setAttribute("oninput","validity.valid||(value='');");const u=document.createElement("div");u.setAttribute("class","form-group");const s=document.createElement("label"),m=document.createElement("input");u.append(m,s),s.textContent="Completed?",s.setAttribute("for","completed"),m.setAttribute("id","completed"),m.setAttribute("type","checkbox"),m.setAttribute("name","completed");const p=document.createElement("i");p.setAttribute("type","button"),p.setAttribute("id","submit"),p.setAttribute("class","material-icons-round"),p.innerHTML="done",p.addEventListener("click",l);const b=document.createElement("i");return b.setAttribute("type","button"),b.setAttribute("id","cancel"),b.setAttribute("class","material-icons-round"),b.innerHTML="close",b.formNoValidate=!0,b.addEventListener("click",(()=>{document.querySelector("#addNewButton").style.display="block",document.querySelector("#input-field").style.display="none",function(){const t=document.getElementById("newBookForm").querySelectorAll("input");for(let e=0;e<t.length-1;e++)t[e].value="",t[t.length-1].checked=!1}()})),n.append(i,o,c,u,p,b),t.appendChild(n),t}());for(let n=0;n<t.length;n++){let i=b(t[n],n);e.appendChild(i)}}h(e())})();