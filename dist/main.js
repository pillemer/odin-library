(()=>{"use strict";function t(t){localStorage.setItem("library",JSON.stringify(t))}function e(){if(localStorage.library){let t=localStorage.getItem("library");return t=JSON.parse(t),t}return[]}function n(t){return(t=t.toLowerCase()).replace(/(^|\s)\S/g,(function(t){return t.toUpperCase()}))}function i(t){return t.replace(/\D/g,"")}function r(n){let r=i(this.id),o=e(),a=o[r];a.complete=!a.complete,t(o);const c=document.getElementById(this.id);a.complete?(c.innerHTML="check_circle_outline",c.title="Mark as Incomplete"):(c.innerHTML="visibility",c.title="Mark as Complete")}class o{constructor(t,e,i,r=!1){this.title=n(t),this.author=n(e),this.pages_total=i,this.pages_read=0,this.rating=0,this.categories=[],this.complete=r}}function a(t){const n=e();let r=i(t),o=n[r];const a=document.getElementById(`tag container ${r}`);a.querySelectorAll(".tag").forEach((t=>{t.parentElement.removeChild(t)})),o.categories.slice().reverse().forEach((t=>{a.prepend(function(t){const e=document.createElement("div");e.setAttribute("class","tag");const n=document.createElement("span");n.innerHTML=t;const i=document.createElement("i");return i.innerHTML="close",i.setAttribute("class","material-icons"),i.setAttribute("id",t),i.addEventListener("click",c),e.appendChild(n),e.appendChild(i),e}(t))}))}function c(n){const r=e(),o=i(n.target.parentNode.parentNode.id),c=r[o];let l=c.categories.indexOf(n.target.id);c.categories.splice(l,1),t(r),a(o)}function l(n){if(""!=n.target.value&&"Enter"===n.key){const r=e(),o=i(n.target.id);n.target.value.split(",").forEach((e=>{r[o].categories.push(e),t(r)})),a(n.target.id),n.target.value=""}}function d(t){let e=i(this.id);const n=document.getElementById(`card ${e}`);n.querySelector(".cardFace").style.display="none";const r=document.createElement("div");r.setAttribute("class","tag-edit-container"),r.setAttribute("id",`tag edit container ${e}`);const o=document.createElement("div");o.setAttribute("class","tag-container"),o.setAttribute("id",`tag container ${e}`);const c=document.createElement("input");c.setAttribute("id",`tag input ${e}`),o.appendChild(c),c.addEventListener("keyup",l);const d=document.createElement("i");d.setAttribute("type","button"),d.innerHTML="done",d.setAttribute("title","Done"),d.setAttribute("class","material-icons-round doneButton"),d.setAttribute("id",`finish tagging ${e}`),d.addEventListener("click",(()=>{n.querySelector(".cardFace").style.display="block";let t=i(this.id);document.getElementById(`tag edit container ${t}`).remove(),document.getElementById(`finish tagging ${t}`).remove()})),r.appendChild(o),n.append(r,d),a(e),c.focus()}function s(){document.querySelector("main").innerHTML="",m()}function u(e,n){const i=document.createElement("div");i.title=e.title,i.id=`card ${n}`,i.className="card";const o=document.createElement("container");o.className="cardFace";const a=document.createElement("div");a.className="content";const c=document.createElement("progress");c.setAttribute("max",e.pages_total),c.setAttribute("id",`progress ${n}`),c.setAttribute("value",e.pages_read),c.setAttribute("title",`You're on page ${e.pages_read} out of ${e.pages_total}.`),c.addEventListener("click",(()=>{let n=parseInt(prompt("What page are you on?"));n>=e.pages_total&&(n=e.pages_total),n<0|!n||(e.pages_read=n,t(g),s())})),a.appendChild(c);const l=document.createElement("div");l.className="rating-box",l.title=e.rating/20*10/10+" stars";const u=document.createElement("div");u.className="rating",u.style.width=e.rating+"%",l.setAttribute("id",`rating ${n}`),l.addEventListener("click",(i=>{const r=document.getElementById(`rating ${n}`);r.querySelector(".rating").style.width=i.layerX+"%",e.rating=i.layerX,r.title=e.rating/20*10/10+" stars",t(g)})),l.appendChild(u),a.appendChild(l);const m=document.createElement("p");m.textContent=`"${e.title}"`,m.title=`Title: "${e.title}"`,m.setAttribute("class","bookTitle"),a.appendChild(m);const p=document.createElement("p");p.textContent=e.author,p.title=`Author: "${e.author}"`,p.setAttribute("class","bookAuthor"),a.appendChild(p),o.appendChild(a);const b=document.createElement("div");b.setAttribute("class","cardButtons");const y=document.createElement("i");y.innerHTML="delete_forever",y.setAttribute("title","Remove book from library"),y.setAttribute("class","material-icons-round deleteButton"),y.setAttribute("id",`remove ${n}`),y.addEventListener("click",A),b.appendChild(y);const E=document.createElement("i");E.innerHTML="label",E.setAttribute("title","Add tags"),E.setAttribute("class","material-icons-round tagButton"),E.setAttribute("id",`tag ${n}`),E.addEventListener("click",d),b.appendChild(E);const v=document.createElement("i");v.innerHTML="create",v.setAttribute("title","Edit book details"),v.setAttribute("class","material-icons-round editButton"),v.setAttribute("id",`edit ${n}`),v.addEventListener("click",h),b.appendChild(v);const f=document.createElement("i");return e.complete?(f.innerHTML="check_circle_outline",f.setAttribute("title","Mark as unread")):(f.innerHTML="visibility",f.setAttribute("title","Mark as Complete")),f.setAttribute("class","material-icons-round completeButton"),f.setAttribute("id",`complete ${n}`),f.addEventListener("click",r),b.appendChild(f),o.appendChild(b),i.appendChild(o),i}function m(){const t=document.querySelector("main");t.appendChild(function(){const t=document.createElement("div");t.className="card",t.id="newBookForm";const e=document.createElement("button");e.id="addNewButton",e.title="Add new book to Library",e.textContent="+",e.addEventListener("click",(()=>{document.querySelector("#input-field").style.display="initial",e.style.display="none"})),t.appendChild(e);const n=document.createElement("form");n.id="input-field";const i=document.createElement("div"),r=document.createElement("input");i.appendChild(r),r.setAttribute("placeholder","Book Title"),r.setAttribute("id","title"),r.setAttribute("type","text"),r.setAttribute("name","title");const o=document.createElement("div"),a=document.createElement("input");o.appendChild(a),a.setAttribute("placeholder","Author"),a.setAttribute("id","author"),a.setAttribute("type","text"),a.setAttribute("name","author");const c=document.createElement("div"),l=document.createElement("input");c.appendChild(l),l.setAttribute("placeholder","Page count"),l.setAttribute("id","bookLength"),l.setAttribute("type","number"),l.setAttribute("name","bookLength"),l.setAttribute("min","0"),l.setAttribute("oninput","validity.valid||(value='');");const d=document.createElement("div");d.setAttribute("class","form-group");const s=document.createElement("label"),u=document.createElement("input");d.append(u,s),s.textContent="Completed?",s.setAttribute("for","completed"),u.setAttribute("id","completed"),u.setAttribute("type","checkbox"),u.setAttribute("name","completed");const m=document.createElement("i");m.setAttribute("type","button"),m.setAttribute("id","submit"),m.setAttribute("class","material-icons-round"),m.innerHTML="done",m.addEventListener("click",p);const b=document.createElement("i");return b.setAttribute("type","button"),b.setAttribute("id","cancel"),b.setAttribute("class","material-icons-round"),b.innerHTML="close",b.formNoValidate=!0,b.addEventListener("click",(()=>{document.querySelector("#addNewButton").style.display="block",document.querySelector("#input-field").style.display="none",function(){const t=document.querySelectorAll("input");for(let e=0;e<t.length-1;e++)t[e].value="",t[t.length-1].checked=!1}()})),n.append(i,o,c,d,m,b),t.appendChild(n),t}());for(let e=0;e<g.length;e++){let n=u(g[e],e);t.appendChild(n)}}function p(){const e=document.querySelectorAll("input");for(let t=0;t<e.length-1;t++)if(""==e[t].value)return void alert("fill in all the details before submitting");const n=new o(e[0].value,e[1].value,e[2].value,e[3].checked);g.push(n),t(g),s()}function b(e){let n=i(this.id),r=g[n];const o=document.getElementById(`card ${n}`),a=o.querySelector(".content"),c=document.getElementById(`update-input-field${n}`).querySelectorAll("input");for(let t=0;t<c.length;t++)if(""==c[t].value)return void alert("input cannot be left empty!");r.title=c[0].value,a.querySelector(".bookTitle").innerHTML=r.title,a.querySelector(".bookTitle").title=`Title: "${r.title}"`,r.author=c[1].value,a.querySelector(".bookAuthor").innerHTML=r.author,a.querySelector(".bookAuthor").title=`Author: "${r.author}"`,r.pages_total=c[2].value,t(g),document.getElementById(`update-input-field${n}`).remove(),o.querySelector(".cardFace").style.display="block"}function A(e){let n=i(this.id);g.splice(n,1),t(g),s()}function h(t){let e=i(this.id),n=g[e];const r=document.getElementById(`card ${e}`);r.querySelector(".cardFace").style.display="none";const o=document.createElement("form");o.id=`update-input-field${e}`;const a=document.createElement("div"),c=document.createElement("input");a.appendChild(c),c.setAttribute("value",n.title),c.setAttribute("type","text"),c.setAttribute("name","Edit Title"),c.minlength=1;const l=document.createElement("div"),d=document.createElement("input");l.appendChild(d),d.setAttribute("value",n.author),d.setAttribute("type","text"),d.setAttribute("name","Edit Author"),d.required=!0;const s=document.createElement("div"),u=document.createElement("input");s.appendChild(u),u.setAttribute("value",n.pages_total),u.setAttribute("type","number"),u.setAttribute("name","Edit Total Pages"),u.setAttribute("min","0"),u.setAttribute("oninput","validity.valid||(value='');"),u.required=!0;const m=document.createElement("i");m.setAttribute("type","button"),m.setAttribute("class","material-icons-round"),m.setAttribute("id",`update ${e}`),m.innerHTML="done",m.addEventListener("click",b);const p=document.createElement("i");p.setAttribute("type","button"),p.setAttribute("class","material-icons-round"),p.innerHTML="close",p.formNoValidate=!0,p.addEventListener("click",(()=>{r.querySelector(".cardFace").style.display="initial";let t=i(this.id);document.querySelector(`#update-input-field${t}`).remove()})),o.append(a,l,s,m,p),r.appendChild(o),c.focus()}let g=e();m()})();