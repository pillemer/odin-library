(()=>{"use strict";function t(t){localStorage.setItem("library",JSON.stringify(t))}function e(){if(localStorage.library){let t=localStorage.getItem("library");return t=JSON.parse(t),t}return[]}function n(t){return(t=t.toLowerCase()).replace(/(^|\s)\S/g,(function(t){return t.toUpperCase()}))}function i(t){return t.replace(/\D/g,"")}function r(t,e=!1){e?(t.innerHTML="check_circle_outline",t.setAttribute("title","Mark as Unread")):(t.innerHTML="visibility",t.setAttribute("title","Mark as Complete"))}class o{constructor(t,e,i,r=!1){this.title=n(t),this.author=n(e),this.pages_total=i,this.pages_read=0,this.rating=0,this.categories=[],this.complete=r}}function c(){let n=i(this.id),r=e();r.splice(n,1),t(r),y()}function l(){const n=document.getElementById("newBookForm").querySelectorAll("input");for(let t=0;t<n.length-1;t++)if(""==n[t].value)return void alert("fill in all the details before submitting");const i=new o(n[0].value,n[1].value,n[2].value,n[3].checked);let r=e();r.push(i),t(r),y()}function a(t){const n=e();let r=i(t),o=n[r];const c=document.getElementById(`tag container ${r}`);c.querySelectorAll(".tag").forEach((t=>{t.parentElement.removeChild(t)})),o.categories.slice().reverse().forEach((t=>{c.prepend(function(t){const e=document.createElement("div");e.setAttribute("class","tag");const n=document.createElement("span");n.innerHTML=t;const i=document.createElement("i");return i.innerHTML="close",i.setAttribute("class","material-icons"),i.setAttribute("id",t),i.addEventListener("click",d),e.appendChild(n),e.appendChild(i),e}(t))}))}function d(n){const r=e(),o=i(n.target.parentNode.parentNode.id),c=r[o];let l=c.categories.indexOf(n.target.id);c.categories.splice(l,1),t(r),a(o)}function u(n){if(""!=n.target.value&&"Enter"===n.key){const r=e(),o=i(n.target.id);n.target.value.split(",").forEach((e=>{r[o].categories.push(e),t(r)})),a(n.target.id),n.target.value=""}}function s(){let t=i(this.id);const e=document.getElementById(`card ${t}`);e.querySelector(".cardFace").style.display="none";const n=document.createElement("div");n.setAttribute("class","tag-edit-container"),n.setAttribute("id",`tag edit container ${t}`);const r=document.createElement("div");r.setAttribute("class","tag-container"),r.setAttribute("id",`tag container ${t}`);const o=document.createElement("input");o.setAttribute("id",`tag input ${t}`),r.appendChild(o),o.addEventListener("keyup",u);const c=document.createElement("i");c.setAttribute("type","button"),c.innerHTML="done",c.setAttribute("title","Done"),c.setAttribute("class","material-icons-round doneButton"),c.setAttribute("id",`finish tagging ${t}`),c.addEventListener("click",(()=>{e.querySelector(".cardFace").style.display="block";let t=i(this.id);document.getElementById(`tag edit container ${t}`).remove(),document.getElementById(`finish tagging ${t}`).remove()})),n.appendChild(r),e.append(n,c),a(t),o.focus()}function m(){let n=i(this.id),o=e(),c=o[n];c.complete=!c.complete,t(o),r(document.getElementById(this.id),c.complete)}function p(){let n=i(this.id),r=e(),o=r[n];const c=document.getElementById(`card ${n}`),l=c.querySelector(".content"),a=document.getElementById(`update-input-field${n}`).querySelectorAll("input");for(let t=0;t<a.length;t++)if(""==a[t].value)return void alert("input cannot be left empty!");o.title=a[0].value,l.querySelector(".bookTitle").innerHTML=`"${o.title}"`,l.querySelector(".bookTitle").title=`Title: "${o.title}"`,o.author=a[1].value,l.querySelector(".bookAuthor").innerHTML=o.author,l.querySelector(".bookAuthor").title=`Author: "${o.author}"`,o.pages_total=a[2].value,t(r),document.getElementById(`update-input-field${n}`).remove(),c.querySelector(".cardFace").style.display="block"}function b(){let n=i(this.id),r=e();const o=r[n];let c=parseInt(prompt("What page are you on?"));c>=o.pages_total&&(c=o.pages_total),c<0|!c||(o.pages_read=c,t(r),y())}function h(n){let r=i(this.id),o=e();const c=o[r],l=document.getElementById(`rating ${r}`).querySelector(".rating");l.style.width=n.layerX+"%",c.rating=n.layerX,l.title=c.rating/20*10/10+" stars",t(o)}function A(t,e){const n=document.createElement("div");n.title=t.title,n.id=`card ${e}`,n.className="card";const i=document.createElement("container");i.className="cardFace";const o=document.createElement("div");o.className="content";const l=document.createElement("progress");l.setAttribute("max",t.pages_total),l.setAttribute("id",`progress ${e}`),l.setAttribute("value",t.pages_read),l.setAttribute("title",`You're on page ${t.pages_read} out of ${t.pages_total}.`),l.addEventListener("click",b),o.appendChild(l);const a=document.createElement("div");a.className="rating-box",a.title=t.rating/20*10/10+" stars";const d=document.createElement("div");d.className="rating",d.style.width=t.rating+"%",a.setAttribute("id",`rating ${e}`),a.addEventListener("click",h),a.appendChild(d),o.appendChild(a);const u=document.createElement("p");u.textContent=`"${t.title}"`,u.title=`Title: "${t.title}"`,u.setAttribute("class","bookTitle"),o.appendChild(u);const p=document.createElement("p");p.textContent=t.author,p.title=`Author: "${t.author}"`,p.setAttribute("class","bookAuthor"),o.appendChild(p),i.appendChild(o);const A=document.createElement("div");A.setAttribute("class","cardButtons");const y=document.createElement("i");y.innerHTML="delete_forever",y.setAttribute("title","Remove book from library"),y.setAttribute("class","material-icons-round deleteButton"),y.setAttribute("id",`remove ${e}`),y.addEventListener("click",c),A.appendChild(y),A.appendChild(function(t){const e=document.createElement("i");return e.innerHTML="label",e.setAttribute("title","Add tags"),e.setAttribute("class","material-icons-round tagButton"),e.setAttribute("id",`tag ${t}`),e.addEventListener("click",s),e}(e));const E=document.createElement("i");E.innerHTML="create",E.setAttribute("title","Edit book details"),E.setAttribute("class","material-icons-round editButton"),E.setAttribute("id",`edit ${e}`),E.addEventListener("click",g),A.appendChild(E);const v=function(t){const e=document.createElement("i");return e.setAttribute("class","material-icons-round completeButton"),e.setAttribute("id",`complete ${t}`),e.addEventListener("click",m),e}(e);return r(v,t.complete),A.appendChild(v),i.appendChild(A),n.appendChild(i),n}function g(){let t=i(this.id),n=e()[t];const r=document.getElementById(`card ${t}`);r.querySelector(".cardFace").style.display="none";const o=document.createElement("form");o.id=`update-input-field${t}`;const c=document.createElement("div"),l=document.createElement("input");c.appendChild(l),l.setAttribute("value",n.title),l.setAttribute("type","text"),l.setAttribute("name","Edit Title"),l.minlength=1;const a=document.createElement("div"),d=document.createElement("input");a.appendChild(d),d.setAttribute("value",n.author),d.setAttribute("type","text"),d.setAttribute("name","Edit Author"),d.required=!0;const u=document.createElement("div"),s=document.createElement("input");u.appendChild(s),s.setAttribute("value",n.pages_total),s.setAttribute("type","number"),s.setAttribute("name","Edit Total Pages"),s.setAttribute("min","0"),s.setAttribute("oninput","validity.valid||(value='');"),s.required=!0;const m=document.createElement("i");m.setAttribute("type","button"),m.setAttribute("class","material-icons-round"),m.setAttribute("id",`update ${t}`),m.innerHTML="done",m.addEventListener("click",p);const b=document.createElement("i");b.setAttribute("type","button"),b.setAttribute("class","material-icons-round"),b.innerHTML="close",b.formNoValidate=!0,b.addEventListener("click",(()=>{r.querySelector(".cardFace").style.display="initial";let t=i(this.id);document.querySelector(`#update-input-field${t}`).remove()})),o.append(c,a,u,m,b),r.appendChild(o),l.focus()}function y(){let t=e();document.querySelector("main").innerHTML="",E(t)}function E(t){const e=document.querySelector("main");e.appendChild(function(){const t=document.createElement("div");t.className="card",t.id="newBookForm";const e=document.createElement("button");e.id="addNewButton",e.title="Add new book to Library",e.textContent="+",e.addEventListener("click",(()=>{document.querySelector("#input-field").style.display="initial",e.style.display="none"})),t.appendChild(e);const n=document.createElement("form");n.id="input-field";const i=document.createElement("div"),r=document.createElement("input");i.appendChild(r),r.setAttribute("placeholder","Book Title"),r.setAttribute("id","title"),r.setAttribute("type","text"),r.setAttribute("name","title");const o=document.createElement("div"),c=document.createElement("input");o.appendChild(c),c.setAttribute("placeholder","Author"),c.setAttribute("id","author"),c.setAttribute("type","text"),c.setAttribute("name","author");const a=document.createElement("div"),d=document.createElement("input");a.appendChild(d),d.setAttribute("placeholder","Page count"),d.setAttribute("id","bookLength"),d.setAttribute("type","number"),d.setAttribute("name","bookLength"),d.setAttribute("min","0"),d.setAttribute("oninput","validity.valid||(value='');");const u=document.createElement("div");u.setAttribute("class","form-group");const s=document.createElement("label"),m=document.createElement("input");u.append(m,s),s.textContent="Completed?",s.setAttribute("for","completed"),m.setAttribute("id","completed"),m.setAttribute("type","checkbox"),m.setAttribute("name","completed");const p=document.createElement("i");p.setAttribute("type","button"),p.setAttribute("id","submit"),p.setAttribute("class","material-icons-round"),p.innerHTML="done",p.addEventListener("click",l);const b=document.createElement("i");return b.setAttribute("type","button"),b.setAttribute("id","cancel"),b.setAttribute("class","material-icons-round"),b.innerHTML="close",b.formNoValidate=!0,b.addEventListener("click",(()=>{document.querySelector("#addNewButton").style.display="block",document.querySelector("#input-field").style.display="none",function(){const t=document.getElementById("newBookForm").querySelectorAll("input");for(let e=0;e<t.length-1;e++)t[e].value="",t[t.length-1].checked=!1}()})),n.append(i,o,a,u,p,b),t.appendChild(n),t}());for(let n=0;n<t.length;n++){let i=A(t[n],n);e.appendChild(i)}}E(e())})();