(()=>{"use strict";function t(t){return(t=t.toLowerCase()).replace(/(^|\s)\S/g,(function(t){return t.toUpperCase()}))}function e(t){return t.replace(/\D/g,"")}function n(t,e=!1){e?(t.innerHTML="check_circle_outline",t.setAttribute("title","Mark as Unread")):(t.innerHTML="visibility",t.setAttribute("title","Mark as Complete"))}class i{constructor(e,n,i,r=!1){this.title=t(e),this.author=t(n),this.pages_total=i,this.pages_read=0,this.rating=0,this.categories=[],this.complete=r}}function r(t){localStorage.setItem("library",JSON.stringify(t))}function o(){if(localStorage.library){let t=localStorage.getItem("library");return t=JSON.parse(t),t}return[]}function c(t){const n=o();let i=e(t),r=n[i];const c=document.getElementById(`tag container ${i}`);c.querySelectorAll(".tag").forEach((t=>{t.parentElement.removeChild(t)})),r.categories.slice().reverse().forEach((t=>{c.prepend(function(t){const e=document.createElement("div");e.setAttribute("class","tag");const n=document.createElement("span");n.innerHTML=t;const i=document.createElement("i");return i.innerHTML="close",i.setAttribute("class","material-icons"),i.setAttribute("id",t),i.addEventListener("click",a),e.appendChild(n),e.appendChild(i),e}(t))}))}function a(t){const n=o(),i=e(t.target.parentNode.parentNode.id),a=n[i];let l=a.categories.indexOf(t.target.id);a.categories.splice(l,1),r(n),c(i)}function l(t){if(""!=t.target.value&&"Enter"===t.key){const n=o(),i=e(t.target.id);t.target.value.split(",").forEach((t=>{n[i].categories.push(t),r(n)})),c(t.target.id),t.target.value=""}}function d(t){let n=e(this.id);const i=document.getElementById(`card ${n}`);i.querySelector(".cardFace").style.display="none";const r=document.createElement("div");r.setAttribute("class","tag-edit-container"),r.setAttribute("id",`tag edit container ${n}`);const o=document.createElement("div");o.setAttribute("class","tag-container"),o.setAttribute("id",`tag container ${n}`);const a=document.createElement("input");a.setAttribute("id",`tag input ${n}`),o.appendChild(a),a.addEventListener("keyup",l);const d=document.createElement("i");d.setAttribute("type","button"),d.innerHTML="done",d.setAttribute("title","Done"),d.setAttribute("class","material-icons-round doneButton"),d.setAttribute("id",`finish tagging ${n}`),d.addEventListener("click",(()=>{i.querySelector(".cardFace").style.display="block";let t=e(this.id);document.getElementById(`tag edit container ${t}`).remove(),document.getElementById(`finish tagging ${t}`).remove()})),r.appendChild(o),i.append(r,d),c(n),a.focus()}function u(t){let i=e(this.id),c=o(),a=c[i];a.complete=!a.complete,r(c),n(document.getElementById(this.id),a.complete)}function s(){document.querySelector("main").innerHTML="",p()}function m(t,e){const i=document.createElement("div");i.title=t.title,i.id=`card ${e}`,i.className="card";const o=document.createElement("container");o.className="cardFace";const c=document.createElement("div");c.className="content";const a=document.createElement("progress");a.setAttribute("max",t.pages_total),a.setAttribute("id",`progress ${e}`),a.setAttribute("value",t.pages_read),a.setAttribute("title",`You're on page ${t.pages_read} out of ${t.pages_total}.`),a.addEventListener("click",(()=>{let e=parseInt(prompt("What page are you on?"));e>=t.pages_total&&(e=t.pages_total),e<0|!e||(t.pages_read=e,r(y),s())})),c.appendChild(a);const l=document.createElement("div");l.className="rating-box",l.title=t.rating/20*10/10+" stars";const m=document.createElement("div");m.className="rating",m.style.width=t.rating+"%",l.setAttribute("id",`rating ${e}`),l.addEventListener("click",(n=>{const i=document.getElementById(`rating ${e}`);i.querySelector(".rating").style.width=n.layerX+"%",t.rating=n.layerX,i.title=t.rating/20*10/10+" stars",r(y)})),l.appendChild(m),c.appendChild(l);const p=document.createElement("p");p.textContent=`"${t.title}"`,p.title=`Title: "${t.title}"`,p.setAttribute("class","bookTitle"),c.appendChild(p);const b=document.createElement("p");b.textContent=t.author,b.title=`Author: "${t.author}"`,b.setAttribute("class","bookAuthor"),c.appendChild(b),o.appendChild(c);const A=document.createElement("div");A.setAttribute("class","cardButtons");const E=document.createElement("i");E.innerHTML="delete_forever",E.setAttribute("title","Remove book from library"),E.setAttribute("class","material-icons-round deleteButton"),E.setAttribute("id",`remove ${e}`),E.addEventListener("click",h),A.appendChild(E),A.appendChild(function(t){const e=document.createElement("i");return e.innerHTML="label",e.setAttribute("title","Add tags"),e.setAttribute("class","material-icons-round tagButton"),e.setAttribute("id",`tag ${t}`),e.addEventListener("click",d),e}(e));const v=document.createElement("i");v.innerHTML="create",v.setAttribute("title","Edit book details"),v.setAttribute("class","material-icons-round editButton"),v.setAttribute("id",`edit ${e}`),v.addEventListener("click",g),A.appendChild(v);const f=function(t){const e=document.createElement("i");return e.setAttribute("class","material-icons-round completeButton"),e.setAttribute("id",`complete ${t}`),e.addEventListener("click",u),e}(e);return n(f,t.complete),A.appendChild(f),o.appendChild(A),i.appendChild(o),i}function p(){const t=document.querySelector("main");t.appendChild(function(){const t=document.createElement("div");t.className="card",t.id="newBookForm";const e=document.createElement("button");e.id="addNewButton",e.title="Add new book to Library",e.textContent="+",e.addEventListener("click",(()=>{document.querySelector("#input-field").style.display="initial",e.style.display="none"})),t.appendChild(e);const n=document.createElement("form");n.id="input-field";const i=document.createElement("div"),r=document.createElement("input");i.appendChild(r),r.setAttribute("placeholder","Book Title"),r.setAttribute("id","title"),r.setAttribute("type","text"),r.setAttribute("name","title");const o=document.createElement("div"),c=document.createElement("input");o.appendChild(c),c.setAttribute("placeholder","Author"),c.setAttribute("id","author"),c.setAttribute("type","text"),c.setAttribute("name","author");const a=document.createElement("div"),l=document.createElement("input");a.appendChild(l),l.setAttribute("placeholder","Page count"),l.setAttribute("id","bookLength"),l.setAttribute("type","number"),l.setAttribute("name","bookLength"),l.setAttribute("min","0"),l.setAttribute("oninput","validity.valid||(value='');");const d=document.createElement("div");d.setAttribute("class","form-group");const u=document.createElement("label"),s=document.createElement("input");d.append(s,u),u.textContent="Completed?",u.setAttribute("for","completed"),s.setAttribute("id","completed"),s.setAttribute("type","checkbox"),s.setAttribute("name","completed");const m=document.createElement("i");m.setAttribute("type","button"),m.setAttribute("id","submit"),m.setAttribute("class","material-icons-round"),m.innerHTML="done",m.addEventListener("click",b);const p=document.createElement("i");return p.setAttribute("type","button"),p.setAttribute("id","cancel"),p.setAttribute("class","material-icons-round"),p.innerHTML="close",p.formNoValidate=!0,p.addEventListener("click",(()=>{document.querySelector("#addNewButton").style.display="block",document.querySelector("#input-field").style.display="none",function(){const t=document.querySelectorAll("input");for(let e=0;e<t.length-1;e++)t[e].value="",t[t.length-1].checked=!1}()})),n.append(i,o,a,d,m,p),t.appendChild(n),t}());for(let e=0;e<y.length;e++){let n=m(y[e],e);t.appendChild(n)}}function b(){const t=document.querySelectorAll("input");for(let e=0;e<t.length-1;e++)if(""==t[e].value)return void alert("fill in all the details before submitting");const e=new i(t[0].value,t[1].value,t[2].value,t[3].checked);y.push(e),r(y),s()}function A(t){let n=e(this.id),i=y[n];const o=document.getElementById(`card ${n}`),c=o.querySelector(".content"),a=document.getElementById(`update-input-field${n}`).querySelectorAll("input");for(let t=0;t<a.length;t++)if(""==a[t].value)return void alert("input cannot be left empty!");i.title=a[0].value,c.querySelector(".bookTitle").innerHTML=i.title,c.querySelector(".bookTitle").title=`Title: "${i.title}"`,i.author=a[1].value,c.querySelector(".bookAuthor").innerHTML=i.author,c.querySelector(".bookAuthor").title=`Author: "${i.author}"`,i.pages_total=a[2].value,r(y),document.getElementById(`update-input-field${n}`).remove(),o.querySelector(".cardFace").style.display="block"}function h(t){let n=e(this.id);y.splice(n,1),r(y),s()}function g(t){let n=e(this.id),i=y[n];const r=document.getElementById(`card ${n}`);r.querySelector(".cardFace").style.display="none";const o=document.createElement("form");o.id=`update-input-field${n}`;const c=document.createElement("div"),a=document.createElement("input");c.appendChild(a),a.setAttribute("value",i.title),a.setAttribute("type","text"),a.setAttribute("name","Edit Title"),a.minlength=1;const l=document.createElement("div"),d=document.createElement("input");l.appendChild(d),d.setAttribute("value",i.author),d.setAttribute("type","text"),d.setAttribute("name","Edit Author"),d.required=!0;const u=document.createElement("div"),s=document.createElement("input");u.appendChild(s),s.setAttribute("value",i.pages_total),s.setAttribute("type","number"),s.setAttribute("name","Edit Total Pages"),s.setAttribute("min","0"),s.setAttribute("oninput","validity.valid||(value='');"),s.required=!0;const m=document.createElement("i");m.setAttribute("type","button"),m.setAttribute("class","material-icons-round"),m.setAttribute("id",`update ${n}`),m.innerHTML="done",m.addEventListener("click",A);const p=document.createElement("i");p.setAttribute("type","button"),p.setAttribute("class","material-icons-round"),p.innerHTML="close",p.formNoValidate=!0,p.addEventListener("click",(()=>{r.querySelector(".cardFace").style.display="initial";let t=e(this.id);document.querySelector(`#update-input-field${t}`).remove()})),o.append(c,l,u,m,p),r.appendChild(o),a.focus()}let y=o();p()})();